<!DOCTYPE html>

<html lang="en">
<head><meta charset="utf-8"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="jupyter_style.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="navbar.js"></script>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ETL With Postgres</title><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

<!-- Load mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>
<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
<!-- End of mathjax configuration --><script type="module">
  document.addEventListener("DOMContentLoaded", async () => {
    const diagrams = document.querySelectorAll(".jp-Mermaid > pre.mermaid");
    // do not load mermaidjs if not needed
    if (!diagrams.length) {
      return;
    }
    const mermaid = (await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.0/mermaid.esm.min.mjs")).default;
    const parser = new DOMParser();

    mermaid.initialize({
      maxTextSize: 100000,
      startOnLoad: false,
      fontFamily: window
        .getComputedStyle(document.body)
        .getPropertyValue("--jp-ui-font-family"),
      theme: document.querySelector("body[data-jp-theme-light='true']")
        ? "default"
        : "dark",
    });

    let _nextMermaidId = 0;

    function makeMermaidImage(svg) {
      const img = document.createElement("img");
      const doc = parser.parseFromString(svg, "image/svg+xml");
      const svgEl = doc.querySelector("svg");
      const { maxWidth } = svgEl?.style || {};
      const firstTitle = doc.querySelector("title");
      const firstDesc = doc.querySelector("desc");

      img.setAttribute("src", `data:image/svg+xml,${encodeURIComponent(svg)}`);
      if (maxWidth) {
        img.width = parseInt(maxWidth);
      }
      if (firstTitle) {
        img.setAttribute("alt", firstTitle.textContent);
      }
      if (firstDesc) {
        const caption = document.createElement("figcaption");
        caption.className = "sr-only";
        caption.textContent = firstDesc.textContent;
        return [img, caption];
      }
      return [img];
    }

    async function makeMermaidError(text) {
      let errorMessage = "";
      try {
        await mermaid.parse(text);
      } catch (err) {
        errorMessage = `${err}`;
      }

      const result = document.createElement("details");
      result.className = 'jp-RenderedMermaid-Details';
      const summary = document.createElement("summary");
      summary.className = 'jp-RenderedMermaid-Summary';
      const pre = document.createElement("pre");
      const code = document.createElement("code");
      code.innerText = text;
      pre.appendChild(code);
      summary.appendChild(pre);
      result.appendChild(summary);

      const warning = document.createElement("pre");
      warning.innerText = errorMessage;
      result.appendChild(warning);
      return [result];
    }

    async function renderOneMarmaid(src) {
      const id = `jp-mermaid-${_nextMermaidId++}`;
      const parent = src.parentNode;
      let raw = src.textContent.trim();
      const el = document.createElement("div");
      el.style.visibility = "hidden";
      document.body.appendChild(el);
      let results = null;
      let output = null;
      try {
        const { svg } = await mermaid.render(id, raw, el);
        results = makeMermaidImage(svg);
        output = document.createElement("figure");
        results.map(output.appendChild, output);
      } catch (err) {
        parent.classList.add("jp-mod-warning");
        results = await makeMermaidError(raw);
        output = results[0];
      } finally {
        el.remove();
      }
      parent.classList.add("jp-RenderedMermaid");
      parent.appendChild(output);
    }

    void Promise.all([...diagrams].map(renderOneMarmaid));
  });
</script>
<style>
  .jp-Mermaid:not(.jp-RenderedMermaid) {
    display: none;
  }

  .jp-RenderedMermaid {
    overflow: auto;
    display: flex;
  }

  .jp-RenderedMermaid.jp-mod-warning {
    width: auto;
    padding: 0.5em;
    margin-top: 0.5em;
    border: var(--jp-border-width) solid var(--jp-warn-color2);
    border-radius: var(--jp-border-radius);
    color: var(--jp-ui-font-color1);
    font-size: var(--jp-ui-font-size1);
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .jp-RenderedMermaid figure {
    margin: 0;
    overflow: auto;
    max-width: 100%;
  }

  .jp-RenderedMermaid img {
    max-width: 100%;
  }

  .jp-RenderedMermaid-Details > pre {
    margin-top: 1em;
  }

  .jp-RenderedMermaid-Summary {
    color: var(--jp-warn-color2);
  }

  .jp-RenderedMermaid:not(.jp-mod-warning) pre {
    display: none;
  }

  .jp-RenderedMermaid-Summary > pre {
    display: inline-block;
    white-space: normal;
  }
</style>
<!-- End of mermaid configuration --></head>
<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">
  <!-- NAVBAR -->
  <div id="navbar-container"></div>
<main>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="ETL-Processes">ETL Processes<a class="anchor-link" href="#ETL-Processes">¶</a></h1><p>This notebook was developed under the direction of Udacity, but the code is my own. In this notebook, I extract data from nested directories of JSON files and load the data into a PostgreSQL database. In the <a href=postgres_test.html>test.ipynb </a>file, I query that database using ipython-sql. The 'create_tables.py' and 'etl.py' files (renamed postgres_create_tables.py and postgres_etl.py, respectively) are available <a href=https://github.com/Amaricopa/Udacity_Code>here</a>.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [2]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Headers; import scripts</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sql_queries</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">create_tables</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">etl</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [3]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#run create_tables to create the database and tables:</span>
<span class="o">%</span><span class="k">run</span> create_tables.py
<span class="c1">#run etl.py to extract the data from the JSON files and insert it into the musicdb tables:</span>
<span class="o">%</span><span class="k">run</span> etl.py
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>71 files found in data/song_data
1/71 files processed.
2/71 files processed.
3/71 files processed.
4/71 files processed.
5/71 files processed.
6/71 files processed.
7/71 files processed.
8/71 files processed.
9/71 files processed.
10/71 files processed.
11/71 files processed.
12/71 files processed.
13/71 files processed.
14/71 files processed.
15/71 files processed.
16/71 files processed.
17/71 files processed.
18/71 files processed.
19/71 files processed.
20/71 files processed.
21/71 files processed.
22/71 files processed.
23/71 files processed.
24/71 files processed.
25/71 files processed.
26/71 files processed.
27/71 files processed.
28/71 files processed.
29/71 files processed.
30/71 files processed.
31/71 files processed.
32/71 files processed.
33/71 files processed.
34/71 files processed.
35/71 files processed.
36/71 files processed.
37/71 files processed.
38/71 files processed.
39/71 files processed.
40/71 files processed.
41/71 files processed.
42/71 files processed.
43/71 files processed.
44/71 files processed.
45/71 files processed.
46/71 files processed.
47/71 files processed.
48/71 files processed.
49/71 files processed.
50/71 files processed.
51/71 files processed.
52/71 files processed.
53/71 files processed.
54/71 files processed.
55/71 files processed.
56/71 files processed.
57/71 files processed.
58/71 files processed.
59/71 files processed.
60/71 files processed.
61/71 files processed.
62/71 files processed.
63/71 files processed.
64/71 files processed.
65/71 files processed.
66/71 files processed.
67/71 files processed.
68/71 files processed.
69/71 files processed.
70/71 files processed.
71/71 files processed.
30 files found in data/log_data
1/30 files processed.
2/30 files processed.
3/30 files processed.
4/30 files processed.
5/30 files processed.
6/30 files processed.
7/30 files processed.
8/30 files processed.
9/30 files processed.
10/30 files processed.
11/30 files processed.
12/30 files processed.
13/30 files processed.
14/30 files processed.
15/30 files processed.
16/30 files processed.
17/30 files processed.
18/30 files processed.
19/30 files processed.
20/30 files processed.
21/30 files processed.
22/30 files processed.
23/30 files processed.
24/30 files processed.
25/30 files processed.
26/30 files processed.
27/30 files processed.
28/30 files processed.
29/30 files processed.
30/30 files processed.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="Process-song_data">Process <code>song_data</code><a class="anchor-link" href="#Process-song_data">¶</a></h1><p>The remainder of this notebook contains test code I developed under Udacity's direction. The code is then implemented into the create_tables.py and etl.py files (renamed postgres_create_tables.py and postgres_etl.py, respectively) and available <a href=https://github.com/Amaricopa/Udacity_Code>Here</a>.</p>
<p>Here I perform ETL on the first dataset, <code>song_data</code>, to create the <code>songs</code> and <code>artists</code> dimensional tables.</p>
<ul>
<li>Use the <code>get_files</code> function provided above to get a list of all song JSON files in <code>data/song_data</code></li>
<li>Select the first song in this list</li>
<li>Read the song file and view the data</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [5]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#retrieve all filepaths for a dataset; append them to a list called 'all_files'</span>
<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s1">'*.json'</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="p">:</span>
            <span class="n">all_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">all_files</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [6]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Locate the directory containing song_data files:</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s2">"data/song_data"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [7]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">song_files</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [8]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#test to make sure song filepaths are extracted</span>
<span class="n">song_files</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[8]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>['C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAAW128F429D538.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAABD128F429CF47.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAADZ128F9348C2E.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAEF128F4273421.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAFD128F92F423A.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAMO128F1481E7F.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAMQ128F1460CD3.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAPK128E0786D96.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAARJ128F9320760.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAVG12903CFA543.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\A\\TRAAAVO128F93133D4.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABCL128F4286650.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABDL12903CAABBA.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABJL12903CDCF1A.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABJV128F1460C49.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABLR128F423B7E3.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABNV128F425CEE1.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABRB128F9306DD5.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABVM128F92CA9DC.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABXG128F9318EBD.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABYN12903CFD305.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\B\\TRAABYW128F4244559.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACCG128F92E8A55.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACER128F4290F96.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACFV128F935E50B.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACHN128F1489601.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACIW12903CC0F6D.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACLV128F427E123.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACNS128F14A2DF5.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACOW128F933E35F.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACPE128F421C1B9.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACQT128F9331780.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACSL128F93462F4.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACTB12903CAAF15.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACVS128E078BE39.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\A\\C\\TRAACZK128F4243829.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABACN128F425B784.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAFJ128F42AF24E.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAFP128F931E9A1.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAIO128F42938F9.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABATO128F42627E9.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAVQ12903CBF7E0.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAWW128F4250A31.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAXL128F424FC50.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAXR128F426515F.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAXV128F92F6AE3.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\A\\TRABAZH128F930419A.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBAM128F429D223.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBBV128F42967D7.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBJE12903CDB442.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBKX128F4285205.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBLU128F93349CF.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBNP128F932546F.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBOP128F931B50D.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBOR128F4286200.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBTA128F933D304.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBVJ128F92F7EAA.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBXU128F92FEF48.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\B\\TRABBZN12903CD9297.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCAJ12903CDFCC2.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCEC128F426456E.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCEI128F424C983.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCFL128F149BB0D.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCIX128F4265903.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCKL128F423A778.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCPZ128F4275C32.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCRU128F423F449.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCTK128F934B224.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCUQ128E0783E2B.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCXB128F4286BD3.json',
 'C:\\Users\\ammon\\OneDrive\\Desktop\\WGU\\Udacity Projects\\Data Modeling Postgres\\workspace\\home\\data\\song_data\\A\\B\\C\\TRABCYE128F934CE1D.json']</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%231:-songs-Table">#1: <code>songs</code> Table<a class="anchor-link" href="#%231:-songs-Table">¶</a></h2><h4 id="Extract-Data-for-Songs-Table">Extract Data for Songs Table<a class="anchor-link" href="#Extract-Data-for-Songs-Table">¶</a></h4><ul>
<li>Select columns for song ID, title, artist ID, year, and duration</li>
<li>Use <code>df.values</code> to select just the values from the dataframe</li>
<li>Index to select the first (only) record in the dataframe</li>
<li>Convert the array to a list and set it to <code>song_data</code></li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [10]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#create empty dataframe</span>
<span class="n">song_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'song_id'</span><span class="p">,</span> <span class="s1">'title'</span><span class="p">,</span> <span class="s1">'artist_id'</span><span class="p">,</span> <span class="s1">'year'</span><span class="p">,</span> <span class="s1">'duration'</span><span class="p">])</span>
<span class="c1">#create an empty list to hold individual rows until I can concat them to song_data, as</span>
<span class="c1">#suggested by this answer: https://stackoverflow.com/a/71258620</span>
<span class="n">temp_song_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#iterate through each line in song_file:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">song_files</span><span class="p">)):</span>
    <span class="c1">#read in each line. Lines are read in as dataframes:</span>
    <span class="n">song_data_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">song_files</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#omit unused columns:</span>
    <span class="n">song_data_row</span> <span class="o">=</span> <span class="n">song_data_row</span><span class="p">[[</span><span class="s1">'song_id'</span><span class="p">,</span> <span class="s1">'title'</span><span class="p">,</span> <span class="s1">'artist_id'</span><span class="p">,</span> <span class="s1">'year'</span><span class="p">,</span> <span class="s1">'duration'</span><span class="p">]]</span>
    <span class="c1">#append each row to the list of rows:</span>
    <span class="n">temp_song_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song_data_row</span><span class="p">)</span>
<span class="c1">#Add the list of rows to the song_data dataframe:</span>
<span class="n">song_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">temp_song_data</span><span class="p">)</span>
<span class="n">song_data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[10]:</div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html" tabindex="0">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>song_id</th>
<th>title</th>
<th>artist_id</th>
<th>year</th>
<th>duration</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>SOMZWCG12A8C13C480</td>
<td>I Didn't Mean To</td>
<td>ARD7TVE1187B99BFB1</td>
<td>0</td>
<td>218.93179</td>
</tr>
<tr>
<th>0</th>
<td>SOCIWDW12A8C13D406</td>
<td>Soul Deep</td>
<td>ARMJAGH1187FB546F3</td>
<td>1969</td>
<td>148.03546</td>
</tr>
<tr>
<th>0</th>
<td>SOXVLOJ12AB0189215</td>
<td>Amor De Cabaret</td>
<td>ARKRRTF1187B9984DA</td>
<td>0</td>
<td>177.47546</td>
</tr>
<tr>
<th>0</th>
<td>SONHOTT12A8C13493C</td>
<td>Something Girls</td>
<td>AR7G5I41187FB4CE6C</td>
<td>1982</td>
<td>233.40363</td>
</tr>
<tr>
<th>0</th>
<td>SOFSOCN12A8C143F5D</td>
<td>Face the Ashes</td>
<td>ARXR32B1187FB57099</td>
<td>2007</td>
<td>209.60608</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>0</th>
<td>SOINLJW12A8C13314C</td>
<td>City Slickers</td>
<td>AR8IEZO1187B99055E</td>
<td>2008</td>
<td>149.86404</td>
</tr>
<tr>
<th>0</th>
<td>SOGDBUF12A8C140FAA</td>
<td>Intro</td>
<td>AR558FS1187FB45658</td>
<td>2003</td>
<td>75.67628</td>
</tr>
<tr>
<th>0</th>
<td>SORRZGD12A6310DBC3</td>
<td>Harajuku Girls</td>
<td>ARVBRGZ1187FB4675A</td>
<td>2004</td>
<td>290.55955</td>
</tr>
<tr>
<th>0</th>
<td>SODAUVL12A8C13D184</td>
<td>Prognosis</td>
<td>ARWB3G61187FB49404</td>
<td>2000</td>
<td>363.85914</td>
</tr>
<tr>
<th>0</th>
<td>SOFCHDR12AB01866EF</td>
<td>Living Hell</td>
<td>AREVWGE1187B9B890A</td>
<td>0</td>
<td>282.43546</td>
</tr>
</tbody>
</table>
<p>71 rows × 5 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Insert-Record-into-Song-Table">Insert Record into Song Table<a class="anchor-link" href="#Insert-Record-into-Song-Table">¶</a></h4>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [12]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#make new connections because the create_tables.py function closes it when it's done</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">"host=127.0.0.1 dbname=musicdb user=postgres password=mighty"</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [13]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Insert all of the rows into the songs table by iterating row-by-row:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">song_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">song_table_insert</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%232:-artists-Table">#2: <code>artists</code> Table<a class="anchor-link" href="#%232:-artists-Table">¶</a></h2><h4 id="Extract-Data-for-Artists-Table">Extract Data for Artists Table<a class="anchor-link" href="#Extract-Data-for-Artists-Table">¶</a></h4><ul>
<li>Select columns for artist ID, name, location, latitude, and longitude</li>
<li>Use <code>df.values</code> to select just the values from the dataframe</li>
<li>Index to select the first (only) record in the dataframe</li>
<li>Convert the array to a list and set it to <code>artist_data</code></li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [15]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Note: this code was for developing/troubleshooting, so it doesn't iterate over all song_files.</span>
<span class="n">artist_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">song_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">artist_data</span> <span class="o">=</span> <span class="n">artist_data</span><span class="p">[[</span><span class="s1">'artist_id'</span><span class="p">,</span> <span class="s1">'artist_name'</span><span class="p">,</span> <span class="s1">'artist_location'</span><span class="p">,</span> <span class="s1">'artist_latitude'</span><span class="p">,</span> <span class="s1">'artist_longitude'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">artist_data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[15]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>['ARD7TVE1187B99BFB1', 'Casual', 'California - LA', nan, nan]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Insert-Record-into-Artist-Table">Insert Record into Artist Table<a class="anchor-link" href="#Insert-Record-into-Artist-Table">¶</a></h4><p>Implement the <code>artist_table_insert</code> query in <code>sql_queries.py</code> and run the cell below to insert a record for this song's artist into the <code>artists</code> table.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [17]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">artist_table_insert</span><span class="p">,</span> <span class="n">artist_data</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="Process-log_data">Process <code>log_data</code><a class="anchor-link" href="#Process-log_data">¶</a></h1><p>In this part, you'll perform ETL on the second dataset, <code>log_data</code>, to create the <code>time</code> and <code>users</code> dimensional tables, as well as the <code>songplays</code> fact table.</p>
<ul>
<li>Use the <code>get_files</code> function provided above to get a list of all log JSON files in <code>data/log_data</code></li>
<li>Select the first log file in this list</li>
<li>Read the log file and view the data</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [19]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">filepath</span> <span class="o">=</span> <span class="s2">"data/log_data"</span>
<span class="n">log_files</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [20]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">log_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%233:-time-Table">#3: <code>time</code> Table<a class="anchor-link" href="#%233:-time-Table">¶</a></h2><h4 id="Extract-Data-for-Time-Table">Extract Data for Time Table<a class="anchor-link" href="#Extract-Data-for-Time-Table">¶</a></h4><ul>
<li>Filter records by <code>NextSong</code> action</li>
<li>Convert the <code>ts</code> timestamp column to datetime<ul>
<li>Hint: the current timestamp is in milliseconds</li>
</ul>
</li>
<li>Extract the timestamp, hour, day, week of year, month, year, and weekday from the <code>ts</code> column and set <code>time_data</code> to a list containing these values in order<ul>
<li>Hint: use pandas' <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.html"><code>dt</code> attribute</a> to access easily datetimelike properties.</li>
</ul>
</li>
<li>Specify labels for these columns and set to <code>column_labels</code></li>
<li>Create a dataframe, <code>time_df,</code> containing the time data for this file by combining <code>column_labels</code> and <code>time_data</code> into a dictionary and converting this into a dataframe</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [22]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#isolate 'nextsong' rows:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'page'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'NextSong'</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#look at output</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[22]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>2    1541106106796
4    1541106352796
Name: ts, dtype: int64</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [23]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#isolate timestamp column and convert to datetime</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"ms"</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[23]:</div>
<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain" tabindex="0">
<pre>2   2018-11-01 21:01:46.796
4   2018-11-01 21:05:52.796
5   2018-11-01 21:08:16.796
6   2018-11-01 21:11:13.796
7   2018-11-01 21:17:33.796
Name: ts, dtype: datetime64[ns]</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [24]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#extract start_time, hour, day, week of year, month, year, and weekday</span>
<span class="c1">#assign them to a list of lists</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">hours</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<span class="n">weeks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span><span class="p">)</span> <span class="c1">#dt.weekofyear has been deprecated</span>
<span class="n">months</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">weekdays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span>
<span class="n">time_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">weeks</span><span class="p">,</span> <span class="n">months</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">weekdays</span><span class="p">)</span>
<span class="c1">#time_data #look at output</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [25]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#assign column labels. Convert lists to a dictionary</span>
<span class="n">column_labels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'hour'</span><span class="p">,</span> <span class="s1">'day'</span><span class="p">,</span> <span class="s1">'week_of_year'</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">,</span> <span class="s1">'year'</span><span class="p">,</span> <span class="s1">'weekday'</span><span class="p">)</span> <span class="c1">#not used</span>
<span class="n">time_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'start_time'</span><span class="p">:</span> <span class="n">start_time</span><span class="p">,</span> <span class="s1">'hour'</span><span class="p">:</span> <span class="n">hours</span><span class="p">,</span> <span class="s1">'day'</span><span class="p">:</span> <span class="n">days</span><span class="p">,</span> <span class="s1">'week_of_year'</span><span class="p">:</span> <span class="n">weeks</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">:</span> <span class="n">months</span><span class="p">,</span> <span class="s1">'year'</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span> <span class="s1">'weekday'</span><span class="p">:</span> <span class="n">weekdays</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [26]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#time_dict #uncomment to look at my beautiful dictionary</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [27]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#convert time dictionary to a dataframe</span>
<span class="n">time_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">time_dict</span><span class="p">)</span>
<span class="n">time_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[27]:</div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html" tabindex="0">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>start_time</th>
<th>hour</th>
<th>day</th>
<th>week_of_year</th>
<th>month</th>
<th>year</th>
<th>weekday</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>2018-11-01 21:01:46.796</td>
<td>21</td>
<td>1</td>
<td>44</td>
<td>11</td>
<td>2018</td>
<td>3</td>
</tr>
<tr>
<th>1</th>
<td>2018-11-01 21:05:52.796</td>
<td>21</td>
<td>1</td>
<td>44</td>
<td>11</td>
<td>2018</td>
<td>3</td>
</tr>
<tr>
<th>2</th>
<td>2018-11-01 21:08:16.796</td>
<td>21</td>
<td>1</td>
<td>44</td>
<td>11</td>
<td>2018</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>2018-11-01 21:11:13.796</td>
<td>21</td>
<td>1</td>
<td>44</td>
<td>11</td>
<td>2018</td>
<td>3</td>
</tr>
<tr>
<th>4</th>
<td>2018-11-01 21:17:33.796</td>
<td>21</td>
<td>1</td>
<td>44</td>
<td>11</td>
<td>2018</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Insert-Records-into-Time-Table">Insert Records into Time Table<a class="anchor-link" href="#Insert-Records-into-Time-Table">¶</a></h4><p>Implement the <code>time_table_insert</code> query in <code>sql_queries.py</code> and run the cell below to insert records for the timestamps in this log file into the <code>time</code> table. Remember to run <code>create_tables.py</code> before running the cell below to ensure you've created/resetted the <code>time</code> table in the musicdb database.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [29]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">time_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">time_table_insert</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Run <code>test.ipynb</code> to see if you've successfully added records to this table.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%234:-users-Table">#4: <code>users</code> Table<a class="anchor-link" href="#%234:-users-Table">¶</a></h2><h4 id="Extract-Data-for-Users-Table">Extract Data for Users Table<a class="anchor-link" href="#Extract-Data-for-Users-Table">¶</a></h4><ul>
<li>Select columns for user ID, first name, last name, gender and level and set to <code>user_df</code></li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [32]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#look at column names without scrolling:</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[32]:</div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html" tabindex="0">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>artist</th>
<th>auth</th>
<th>firstName</th>
<th>gender</th>
<th>itemInSession</th>
<th>lastName</th>
<th>length</th>
<th>level</th>
<th>location</th>
<th>method</th>
<th>page</th>
<th>registration</th>
<th>sessionId</th>
<th>song</th>
<th>status</th>
<th>ts</th>
<th>userAgent</th>
<th>userId</th>
</tr>
</thead>
<tbody>
<tr>
<th>2</th>
<td>Des'ree</td>
<td>Logged In</td>
<td>Kaylee</td>
<td>F</td>
<td>1</td>
<td>Summers</td>
<td>246.30812</td>
<td>free</td>
<td>Phoenix-Mesa-Scottsdale, AZ</td>
<td>PUT</td>
<td>NextSong</td>
<td>1540344794796</td>
<td>139</td>
<td>You Gotta Be</td>
<td>200</td>
<td>1541106106796</td>
<td>"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebK...</td>
<td>8</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [33]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">user_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'userId'</span><span class="p">,</span> <span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">,</span> <span class="s1">'gender'</span><span class="p">,</span> <span class="s1">'level'</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Insert-Records-into-Users-Table">Insert Records into Users Table<a class="anchor-link" href="#Insert-Records-into-Users-Table">¶</a></h4><p>Implement the <code>user_table_insert</code> query in <code>sql_queries.py</code> and run the cell below to insert records for the users in this log file into the <code>users</code> table. Remember to run <code>create_tables.py</code> before running the cell below to ensure you've created/resetted the <code>users</code> table in the musicdb database.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [35]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#for i, row in user_df.iterrows(): #iterrows triggers a future warning. Switching to itertuples:</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">user_df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1">#conn.commit()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">user_table_insert</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Run <code>test.ipynb</code> to see if you've successfully added records to this table.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="%235:-songplays-Table">#5: <code>songplays</code> Table<a class="anchor-link" href="#%235:-songplays-Table">¶</a></h2><h4 id="Extract-Data-and-Songplays-Table">Extract Data and Songplays Table<a class="anchor-link" href="#Extract-Data-and-Songplays-Table">¶</a></h4><ul>
<li>Implement the <code>song_select</code> query in <code>sql_queries.py</code> to find the song ID and artist ID based on the title, artist name, and duration of a song.</li>
<li>Select the timestamp, user ID, level, song ID, artist ID, session ID, location, and user agent and set to <code>songplay_data</code></li>
</ul>
<h4 id="Insert-Records-into-Songplays-Table">Insert Records into Songplays Table<a class="anchor-link" href="#Insert-Records-into-Songplays-Table">¶</a></h4><ul>
<li>Implement the <code>songplay_table_insert</code> query and run the cell below to insert records for the songplay actions in this log file into the <code>songplays</code> table. Remember to run <code>create_tables.py</code> before running the cell below to ensure you've created/resetted the <code>songplays</code> table in the musicdb database.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [38]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

    <span class="c1"># get songid and artistid from song and artist tables</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">song_select</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">song</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">length</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">songid</span><span class="p">,</span> <span class="n">artistid</span> <span class="o">=</span> <span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">songid</span><span class="p">,</span> <span class="n">artistid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># insert songplay record</span>
    <span class="n">songplay_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"ms"</span><span class="p">),</span> <span class="n">row</span><span class="o">.</span><span class="n">userId</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">songid</span><span class="p">,</span> <span class="n">artistid</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">sessionId</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">userAgent</span><span class="p">)</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">songplay_table_insert</span><span class="p">,</span> <span class="n">songplay_data</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="Close-Connection-to-musicdb-Database">Close Connection to musicdb Database<a class="anchor-link" href="#Close-Connection-to-musicdb-Database">¶</a></h1>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [40]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [ ]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
</div>
</main>
</body>
</html>
